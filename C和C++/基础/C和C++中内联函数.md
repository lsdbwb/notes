# 内联函数
**为什么需要内联函数：**
减少函数调用的开销（函数调用需要一定的时间开销：建立调用、传递参数、跳转到函数代码并返回等等）

**如何使用**：
创建内联函数的方法是使用函数说明符inline

**注意事项：**
inline只是对编译器的建议

内联函数不会在代码块中，因此无法获得内联函数的地址（实际上可以获得内联函数的地址，但是取地址操作会让编译器生成非内联函数）

内联函数比较短小，如果函数较长，那么函数调用的时间开销相对于函数执行的时间较短，使用内联函数不会节省多少时间

编译器在优化内联函数时，必须知道函数的内容。因此*内联函数的定义和对该函数的调用必须处于同一文件*中。因此内联函数通常具有内部链接，在多文件程序中每个想使用该内联函数的文件都需要自己重新定义一份（好的实践是在头文件中定义内联函数，要使用该函数的文件include该头文件）

与c++不同，C允许混合使用内联函数定义和外部函数定义（具有外部链接的函数定义）
```c++
inline void func(int x){}
void func(int x){}
```
编译器可以*随意调用*内部定义或外部定义的函数

**内联函数的缺点**：
1. 如果有一个内联函数多次重复被调用，会增大可执行文件的体积，从而需要更大的内存来加载可执行文件
2. 可能会减少cache hit的几率
3. 可能会增加编译的开销。如果修改了内联函数的定义，所有使用内联函数的文件都需要重新编译
4. 内联函数内如果定义了太多的变量，内联展开后可能会需要更多的寄存器来存这些变量，增加了寄存器的开销

## c++中的内联函数
c++的类内部定义的函数默认是内联函数（隐式内联）
```c++
class C
{
public:
	// func自动内联
	void func(){
		
	}
};
```

好的编程风格应该使用显式内联
```c++
class C
{
	void func(); //只声明
};

// 在类外部定义
inline void func(){

}
```

**在c++中使用内联函数而不是宏**
宏无法访问类的私有成员
宏函数本身不是函数
宏是使用预处理器进行处理，而内联函数是使用c++编译器进行处理

**inline不能和virtual一起使用**
因为inline是在编译期处理，而使用virtual修饰的函数是在运行期进行解析的（动态绑定）

**不要滥用inline**
滥用inline不一定能提升程序性能，反而会带来负面效果

现代编译器会根据你的程序自动决定某个函数是否内联，c++中的inline关键字主要是别的作用。


**c++中什么时候应该使用inline：**
当你想要在头文件中定义一个函数时，应该使用inline。如果不使用，则多个文件包含该头文件后会出现函数重复定义的错误。

链接器会保证如果使用inline定义的函数出现在多个模块，只会选择其中一个定义

