# 日志的作用
日志是用来记录服务器运行状态的工具，记录系统的运行过程和异常信息，为快速定位**系统运行中出现的问题**和开发过程中的**程序调试问题**提供详细的信息
# 日志应该提供的功能
一个较为完善的日志系统应该提供以下的功能
## 日志级别
- 可以根据日志信息的重要性、对系统的影响以及对于使用日志的用户级别不同定义日志的级别
- 不同级别的日志有不同的标识以及不同的处理方式，同时可以根据级别在不同的场景下指定输出日志信息的数量，更加细致地控制日志的输出过程
- 常用的日志级别：
	1. DEBUG  ：一般是开发阶段输出调试信息，在正式环境中应该关闭
	2. INFO ：在生产环境中输出系统运行的一些重要信息
	3. WARN ： 表示系统可能出现了潜在的错误
	4. ERROR ：表示发生了错误事件，打印错误和异常信息，但是系统仍然可以继续运行
	5. FATAL ： 表示出现了重大错误，系统已经无法继续运行下去，可以停止应用程序
## 日志输出格式
- 日志的输出格式是指的每一条日志以什么样的**格式**存放（即每一条日志需要输出哪些信息，这些信息以怎样的格式存放）
- 一条日志的可能的基本输出格式
```
%d{%Y-%m-%d %H:%M:%S}%T%t%T%N%T%F%T[%p]%T[%c]%T%f:%l%T%m%n
格式解释:
%d{%Y-%m-%d %H:%M:%S} : %d 标识输出的是时间 {%Y-%m-%d %H:%M:%S}为时间格式```
%T : Tab[\t]            
%t : 线程id            
%N : 线程名称           
%F : 协程id           
%p : 日志级别            
%c : 日志名称          
%f : 文件名          
%l : 行号             
%m : 日志内容           
%n : 换行符[\r\n]      
```
日志系统需要能够将一条日志按照**预先定义好的日志格式**输出
在上述日志格式下，一条日志可能为下面这样：
```
2019-06-17 00:28:45     9368    main    6       [INFO]  [system]        sylar/tcp_server.cc:64  server bind success: [Socket sock=9 is_connected=0 family=2 type=1 protocol=0 local_address=0.0.0.0:8020]
```
- 日志的输出格式应该可以通过配置文件来更改
## 日志信息输送的目的地
- 日志文件可能根据用途输送到不同的地方：
1. 输出到终端 ：动态查看日志
2. 输出到文件 ：保存日志，以后查看
3.  通过网络输出到专门的日志服务器进行分析
4.  。。。
- 日志系统应该支持根据需要将日志**输送到不同地方**的功能

# 多线程下日志的安全
- 在多线程下保证每条日志的正确性，保证日志产生的时间的先后顺序一致
- 使用锁[[线程、锁、信号量的封装#锁]]来保证安全
- 在使用普通的mutex时，在线程数较多的情况下，写日志的性能和单线程相比下降很多，改成**自旋锁**后，性能和单线程相比差不太多。（线程获取普通mutex时会阻塞，线程获取自旋锁则会先尝试几次，如果仍未获得锁才会阻塞；自旋锁在并发较高且临界区较小的场景下相比普通锁能够较少地陷入内核）
# 日志系统的性能
日志系统应该轻巧，不能占用太多的系统资源，不能影响系统的正常运行
