- 运行时库(Runtime library): 使得程序能够正常运行的支撑库
- c运行时库:使得c程序正常运行的库

## c语言运行时库包含的功能：
1. 启动与退出（包括入口函数和其依赖的函数）
2. 标准库函数（由c语言标准规定的c语言库应该有的函数的实现）
3. IO(IO功能的封装和实现)
4. 堆(堆功能的封装和实现)
5. 语言实现（语言中的一些特殊功能的实现）
6. 调试功能（实现调试功能的代码）

C语言运行时库从某种意义上来说是C语言程序和不同的操作系统平台之间的抽象层，它将不同的操作系统API抽象为相同的函数。

### C语言标准库
以上c语言运行时库中，C语言标准库占据了很大部分。C语言标准库是C语言标准化的基础函数库。c语言标准库跨平台兼容。

## C运行时库的多线程问题
### 线程的访问权限
![[Pasted image 20220414154237.png]]
### 线程局部变量(TLS)的实现原理：
TLS可以认为是每个线程私有的
- 正常情况下，全局变量或者静态变量会放到.data段或者.bss段，是所有线程都可以访问的
- 编译器会将定义的线程局部变量放到别的段里面 （.tls段），在程序运行时，若创建一个新的线程，会先分配一块堆空间，然后将.tls段的内容复制一份，于是每个线程都有自己独立的.tls副本。所以同一个线程局部变量在不同的线程中的地址是不一样的。
- 如果.tls段里面存放了全局的C++对象，则线程启动进行复制操作时还要进行对象的构造，线程退出时要进行对象的析构。
- 线程如何访问tls中的变量：
	- 每个线程都有一个**线程控制块**，线程控制块里面会存放线程的**堆栈地址，线程ID**等相关信息，同时会存放一个**TLS数组**，TLS数组的第一个元素就指向.tls段的地址。得到.tls段的地址后加上偏移即可得到变量的地址。