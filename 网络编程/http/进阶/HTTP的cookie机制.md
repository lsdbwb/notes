# cookie概念
HTTP协议本身是无状态的，HTTP服务端不会记录客户端的信息，相当于每一次HTTP请求都是独立的。因此我们说HTTP服务端是”无记忆的“。

有一些场景需要HTTP服务端有记忆能力（比如用户网上购物的过程）

cookie就是为了让HTTP服务端有一定的”记忆能力“。cookie是服务端让客户端帮忙，相当于是服务器给每个客户端都贴上一张小纸条，上面写了一些只有服务器才能理解的数据，需要的时候客户端把这些信息发给服务器，服务器看到Cookie，就能认出对面是谁了

# cookie工作过程
需要用到两个头字段：响应头字段**Set-Cookie**和请求头字段**Cookie**。

1. 客户通过浏览器第一次向服务端发送HTTP请求时，服务端不知道客户端的身份，所以需要创建一个独特的*身份标识数据*，格式是”key=value“，然后放进Set-Cookie字段，随着响应报文一同发送给浏览器
2. 浏览器收到响应报文，发现里面有Set-Cookie,知道这是浏览器发送过来的身份标识，于是保存起来。下次再向服务端发送HTTP请求时加上Cookie字段。
3. 服务端后面再收到有Cookie字段的请求报文后，就知道这个客户不是新来的，就可以根据cookie的内容识别用户的身份，从而做相应处理
![[Pasted image 20220620155324.png]]

Cookie是由*浏览器*负责存储的，只在本浏览器生效。


# Cookie的属性
cookie就是服务器委托浏览器存储客户的相关数据，而这些数据通常都会记录用户的关键识别信息。所以，就需要在“key=value”外再用一些手段来保护，防止外泄或窃取，这些手段就是Cookie的属性。

1. Cookie的生存周期：cookie只能在一段时间内可用，超过这个期限则认为cookie过期，浏览器要删除这个cookie信息
	Cookie的有效期可以使用Expires和Max-Age两个属性来设置。
	- Expires：过期时间的绝对值
	- Max-Age：过期的相对时间，单位是秒
	![[Pasted image 20220620160532.png]]

2. 我们需要**设置Cookie的作用域**，让浏览器仅发送给特定的服务器和URI，避免被其他网站盗用。
	“**Domain**”和“**Path**”指定了Cookie所属的域名和路径，浏览器在发送Cookie前会从URI中提取出host和path部分，对比Cookie的属性。如果不满足条件，就不会在请求头里发送Cookie

3. cookie的安全性：尽量不要让服务端以外的人看到
写过前端的同学一定知道，在JS脚本里可以用document.cookie来读写Cookie数据，这就带来了安全隐患，有可能会导致“跨站脚本”（XSS）攻击窃取数据。

属性“**HttpOnly**”会告诉浏览器，此Cookie只能通过浏览器HTTP协议传输，禁止其他方式访问，浏览器的JS引擎就会禁用document.cookie等一切相关的API，脚本攻击也就无从谈起了。

另一个属性“**SameSite**”可以防范“跨站请求伪造”（XSRF）攻击，设置成“SameSite=Strict”可以严格限定Cookie不能随着跳转链接跨站发送，而“SameSite=Lax”则略宽松一点，允许GET/HEAD等安全方法，但禁止POST跨站发送。

还有一个属性叫“**Secure**”，表示这个Cookie仅能用HTTPS协议加密传输，明文的HTTP协议会禁止发送。但Cookie本身不是加密的，浏览器里还是以明文的形式存在。

# Cookie的应用
1. Cookie最基本的一个用途就是**身份识别**，保存用户的登录信息，实现会话事务
2. Cookie的另一个常见用途是**广告跟踪**。你上网的时候肯定看过很多的广告图片，这些图片背后都是广告商网站（例如Google），它会“偷偷地”给你贴上Cookie小纸条，这样你上其他的网站，别的广告就能用Cookie读出你的身份，然后做行为分析，再推给你广告。


