# 实现机密性的方法
实现机密性最常用的手段是**加密**，即把消息用某种方式转换成谁也看不懂的乱码，只有解密之后才能再转换回原始文本。

这里的“钥匙”就叫做“**密钥**”（key），加密前的消息叫“**明文**”（plain text/clear text），加密后的乱码叫“**密文**”（cipher text），使用密钥还原明文的过程叫“**解密**”（decrypt），是加密的反操作，加密解密的操作过程就是“**加密算法**”。

加密算法是公开的，任何人都可以去研究，但是密匙是私有的。

## 密匙的定义
由于HTTPS、TLS都运行在计算机上，所以“密钥”就是一长串的数字，但约定俗成的度量单位是“位”（bit），而不是“字节”（byte）。比如，说密钥长度是128，就是16字节的二进制串，密钥长度1024，就是128字节的二进制串。

按照密钥的使用方式，加密可以分为两大类：**对称加密和非对称加密**。

# 对称加密
加密和解密使用的密匙是*同一个*,是对称的，只要保证了密匙的安全，那么整个通信过程就是有了保密性的

![[Pasted image 20220625094002.png]]
只要事先和它约定好使用一个对称密钥，通信过程中传输的全是用密钥加密后的密文

TLS常用的对称加密算法：
1. AES（Advanced Encryption Standard,高级加密标准）。密钥长度可以是128、192或256。它是DES算法的替代者，安全强度很高，性能也很好，而且有的硬件还会做特殊优化，所以非常流行，是应用最广泛的对称加密算法。
2. ChaCha20是Google设计的另一种加密算法，密钥长度固定为256位，纯软件运行性能要超过AES，曾经在移动客户端上比较流行，但ARMv8之后也加入了AES硬件优化，所以现在不再具有明显的优势，但仍然算得上是一个不错的算法

# 加密分组模式
对称加密有两种模式：
- 分组密码，也叫做块加密：一次加密明文的*一个块*。先将明文按照一定的位长分组，明文组经过加密运算的到密文组，密文组经过解密运算得到明文组。
- 序列密码，也叫做流加密：一次加密明文中的*一个位*。是指利用少量的密钥（制乱元素）通过某种复杂的运算（密码）产生大量的伪随机位流，用于对明文位流的加密

在使用块加密时，需要用固定长度的密匙加密任意长度的明文，因此需要对分组密码的算法进行迭代，所以有一个分组模式的概念。

最早有ECB、CBC、CFB、OFB等几种分组模式，但都陆续被发现有安全漏洞，所以现在基本都不怎么用了。最新的分组模式被称为**AEAD**（Authenticated Encryption with Associated Data），在加密的同时增加了认证的功能，常用的是GCM、CCM和Poly1305。

将对称加密算法和分组模式结合起来就是TLS密码套件中定义的对称加密算法[[HTTPS#SSL TLS]]

# 非对称加密
## 对称加密无法解决密匙交换问题
对称加密实现安全性的前提是只有通信双方知道密匙

因此一个很大的问题就是通信双方应该如何安全地交换密匙，术语叫做**密匙交换**

如果通信双方在交换密匙的过程中被黑客窃取，那么黑客也就可以用密匙来解密了，因此只用对称加密是无法解决密匙交换的问题的

## 非对称加密算法
非对称加密算法也叫公钥加密算法
有两个密匙，其中一个叫**公匙**(public key)，一个叫**私匙**(private key)。两个是不对称的，公匙可以公开给任何人使用，私匙是必须保密的。

公匙和私匙的单向性：公匙加密后只能私匙解密，私匙加密后只能公匙解密

## 非对称加密能够解决密匙交换问题
网站秘密保管私匙，在网上任意散发公匙。用户想要上这个网站，则使用公匙就可以了。密文只能由私匙拥有者才能解密，黑客由于没有私匙，因此无法解密密文。



# 非对称加密算法的种类
 非对称加密算法的设计要比对称算法难得多，在TLS里只有很少的几种，比如DH、DSA、RSA、ECC等

***tips:***
因为公匙是可以被所有人获取的，因此非对称加密算法的安全性体现在不能或者说极难**使用公匙经过计算推出私匙**

RSA是其中最著名的一个，它的安全性基于“**整数分解**”的数学难题，使用两个超大素数的乘积作为生成密钥的材料，想要从公钥推算出私钥是非常困难的。10年前RSA密钥的推荐长度是1024，但随着计算机运算能力的提高，现在1024已经不安全，普遍认为至少要2048位。

ECC（Elliptic Curve Cryptography）是非对称加密里的“后起之秀”，它基于“**椭圆曲线离散对数**”的数学难题，使用特定的曲线方程和基点生成公钥和私钥，子算法ECDHE用于密钥交换，ECDSA用于数字签名。

比起RSA，*ECC在安全强度和性能上都有明显的优势*。160位的ECC相当于1024位的RSA，而224位的ECC则相当于2048位的RSA。因为密钥短，所以相应的计算量、消耗的内存和带宽也就少，加密解密的性能就上去了，对于现在的移动互联网非常有吸引力。


# 混合加密
## 为何需要混合加密
- 非对称加密可以解决“密匙交换”的问题，但是其基于复杂的数学难题，*运算速度很慢*
- 对称加密虽然不能解决密匙交换的问题，但是其运算速度很快

因此提出混合加密，即非对称加密和对称加密混合使用，结合两者的优点

## 混合加密的流程
1. 通信刚开始时使用非对称加密算法（RSA,ECDHE）解决密匙交换问题
2. 然后用随机数产生对称算法使用的“会话密匙”，使用公匙加密（会话密钥很短，通常只有16字节或32字节，所以慢一点也无所谓）
3. 对方收到公匙加密的密文后使用私匙解密即可得到“会话密匙”（这样，双方就实现了对称密钥的安全交换，后续就不再使用非对称加密，全都使用对称加密）

![[Pasted image 20220625102556.png]]



## 小结
1.  加密算法的核心思想是“把一个小秘密（密钥）转化为一个大秘密（密文消息）”，守住了小秘密，也就守住了大秘密；
2.  对称加密只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换，常用的有AES和ChaCha20；
3.  非对称加密使用两个密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但速度慢，常用的有RSA和ECC；
4.  把对称加密和非对称加密结合起来就得到了“又好又快”的混合加密，也就是TLS里使用的加密方式。**混合加密解决了机密性问题**