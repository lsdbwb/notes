# HTTP/2的"队头阻塞"
HTTP/2通过*头部压缩、二进制分帧、虚拟的“流”与多路复用*等技术大大提升了HTTP/1的性能，基本解决了队头阻塞的问题。

因为HTTP/2的操作都是在应用层，”队头阻塞“不发生在应用层，但是可能在*底层TCP协议*发生。

从协议栈的角度来看，HTTP/2把报文拆分成一个一个的帧Frame，每个帧Frame交给TCP之后，会被拆分为更小的TCP Segment。在网络状态良好的情况下，包可以很快发到目的地；但是在网络比较差的时候，有可能会丢包。

TCP为了保证可靠传输，有一个丢包重传机制，即丢失的包必须要重新传输确认，其他的包即使已经到了，也只能存在缓冲区里，上层的应用拿不出来。

HTTP/2是应用层协议，只要还使用TCP作为底层传输协议，就不可能在应用层去解决TCP层的问题

# HTTP/3
为了解决HTTP/2的因为TCP带来的”队头阻塞问题“，HTTP/3直接不使用TCP协议，而是重新发明了一个新的”QUIC“协议

**HTTP/3 = HTTP Over QUIC**

![[Pasted image 20220701102136.png]]

# QUIC协议
HTTP/3把下层的TCP换成了UDP，然后自己实现了一个QUIC协议

UDP只是在IP层上的简单封装，简单并且不可靠，只是尽最大努力交付报文。并且UDP是无序的，包之间没有依赖关系。

QUIC可以理解为用户态的TCP协议：
QUIC选定了UDP，在它之上把TCP的那一套*连接管理、拥塞窗口、流量控制*等“搬”了过来，“去其糟粕，取其精华”，打造出了一个全新的可靠传输协议，可以认为是“**新时代的TCP**”。



## 小结
HTTP/3综合了我们之前讲的所有技术（HTTP/1、SSL/TLS、HTTP/2），包含知识点很多，比如队头阻塞、0-RTT握手、虚拟的“流”、多路复用，算得上是“集大成之作”，需要多下些功夫好好体会。

1.  HTTP/3基于QUIC协议，完全解决了“队头阻塞”问题，弱网环境下的表现会优于HTTP/2；
    
2.  QUIC是一个新的传输层协议，建立在UDP之上，实现了可靠传输；
    
3.  QUIC内含了TLS1.3，只能加密通信，支持0-RTT快速建连；
    
4.  QUIC的连接使用“不透明”的连接ID，不绑定在“IP地址+端口”上，支持“连接迁移”；
    
5.  QUIC的流与HTTP/2的流很相似，但分为双向流和单向流；
    
6.  HTTP/3没有指定默认端口号，需要用HTTP/2的扩展帧“Alt-Svc”来发现。