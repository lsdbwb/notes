# 概念
- B树和B+树都是多路平衡查找树
	1. 多路指一个树节点可能存放多个(>=2)元素,可能有多个叶子节点）
	2. 平衡意味着整棵树的深度很平均
	3. 查找树意味着存放的元素都是有序的（和二叉查找树的特性一样，并且同一个节点内的元素也是有序的）
- B+树是B树的变体，B+树只有叶子节点存放元素value，非叶子节点只存放key
- B树和B+树通常用在数据库底层存储引擎中，比如B+树用于索引

# B树
如下图所示：一个节点里可能有m(m>=2)个元素,相应地会有m+1个叶子节点
![[Pasted image 20220604115936.png]]
## B树的定义
B树是用”阶“来定义的
一个m阶的B树定义如下：
- 每个节点至多有m个孩子节点
- 每个非叶子节点（除了根节点）至少有 ceil(m/2) 个孩子节点
- 若根节点不是叶子节点，则至少有两个孩子
- 所有叶子节点都出现在同一层，叶子节点不包括任何关键字信息
- 某个节点有j个孩子，则存放j-1个元素，并且这些元素都是按递增顺序排列

## B树的查找、插入和删除
### 查找
B树本身是搜索树，搜索树是有序的，所以查找操作和二叉搜索树的查找操作类似
### 插入和删除操作
因为m阶的B树对于每个节点的元素数量有限制，插入和删除操作可能破坏这些限制，因此插入和删除操作除了操作对应元素，还要进行**节点分裂合并**等操作，保持B树的性质

**一棵含有N个总关键字数的m阶的B树的最大高度是多少?答曰：log_ceil（m/2）(N+1)/2 + 1**

# B+树
![[Pasted image 20220604151405.png]]
- 每个节点的元素数量和叶子节点的数量相同(m个元素则有m个叶子节点，B树是m-1个叶子节点)
- 每个节点只存放key和子树的指针，不存放真正的数据
- 数据都存放在叶子节点中，并且每个叶子节点都存放了下一个叶子节点的指针，这样能很方便地进行**范围查询**

# B树和B+树的区别
- B树的查找是不稳定的，可能在中间的任何一个节点找到；B+树查找只能在叶子节点找到数据，所以是稳定的
- B+树每个节点只存放key，因此在数据量大小相同并且磁盘块大小固定的情况下，每个节点能比B树存放更多的数据，可以更加矮胖，减少IO查询的次数
- B+树所有的数据都存在叶子节点，叶子节点形成链表，便于范围查询

# 用途
- 用于数据在磁盘上的存储形式
	读磁盘中的数据都是按块(block)来读的，一个块的大小通常为1KB~4KB；因此B树或者B+树中**每一个节点的大小就是一个磁盘块的大**小，查询一个数据时就是从根节点出发，先将根节点的数据读入内存，再比较数据大小找到叶子节点所在的磁盘块，依次查找直到找到数据（以一个三层高的B树为例子，从中搜索某个数据最多只需要三次磁盘IO）
	